<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>list</title>
<link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> 
<link href="source/css/index.css" rel="stylesheet"/>
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script> 
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="source/layer/layer.js"></script>
</head>
<body>
<div class="container" style="margin-top:20px;">
   	<div class="alert alert-info" style="padding: 5px 15px;">
   		<button type="button" class="btn btn-info btn-sm" id="add">添加</button>
   		<button type="button" class="btn btn-danger btn-sm pull-right" id="out">退出</button>
   	</div>
    <div class="table-responsive">
	  <table class="my_table table table-hover table-bordered table-striped">			    
	    <thead>
	      	<tr>
		        <th>ID</th>
		        <th>标题</th>
		        <th>作者</th>
		        <th>摘要</th>
		        <th>日期</th>
		        <th>操作</th></tr>
	    </thead>
	    <tbody>  
	    </tbody>
	  </table>
	</div>
</div>
<div class="col-sm-10 col-sm-offset-1" id="add_form" style="display:none;margin-top:20px;">
	<form class="form-horizontal" role="form">
	  <input type="hidden" class="form-control"  id="id" name="id">
	  <div class="form-group">	  
	    <div class="col-sm-12">
	      <input type="text" class="form-control" required id="title" name="title" placeholder="请输入标题">
	    </div>
	  </div>
	  <div class="form-group">	   
	    <div class="col-sm-12">
	      <input type="text" class="form-control" required id="author" name="author" placeholder="请输入作者">
	    </div>
	  </div>
	  <div class="form-group">	   
	    <div class="col-sm-12">
	       <textarea class="form-control" id="description"  required name="description" placeholder="请输入摘要" rows="5"></textarea>
	    </div>
	  </div>
	  <div class="form-group">
	    <div class="col-sm-12">
	      <button type="submit" class="btn btn-info btn-block">确定</button>
	    </div>	    
	  </div>
	</form>
</div>
<script>
//进页面加载新闻
$.ajax({
	url:"Index",
	type:"get",
	dataType:"text",
	success:function(data){		
		data = JSON.parse(data);
		if(data.code==0){
			$('.my_table>tbody').empty().append("<tr><td colspan='6'>无数据</td></tr>")
		}else{
			//console.log(JSON.parse(data));
			for(var i in data.result){
				$('.my_table>tbody').append("<tr><td>"+data.result[i].id+"</td><td>"+data.result[i].title+"</td><td>"+data.result[i].author+"</td><td>"+data.result[i].description+"</td><td>"+data.result[i].date+"</td><td><button class='btn btn-info btn-xs' id='modify'>修改</button>&nbsp;<button class='btn btn-danger btn-xs' id='remove'>删除</button></td></tr>")
			}
		
		}						
	}
})
//退出
$("#out").on("click",function(){
	layer.confirm('确定要退出吗？', {
		  btn: ['退出','取消'] //按钮
		}, function(){
			$.ajax({
				url:"Index",
				type:"post",
				data:{
					"action":"out"				
				},		
				dataType:"text",
				success:function(data){
					data = JSON.parse(data);
					console.log(data)
					if(data.code==0){
						layer.msg("登出失败！");
					}else{
						layer.msg("登出成功！",{
							  time: 1000 
						},function(){
							window.location.href='Index';	
						});	 			
					} 
				}
			})
		
		}, function(){
		  layer.msg('再看一会吧！');
	});
})
//点击添加按钮，弹出添加窗口
var index_add_form = 0;//窗口标识
var action_flag=0;//添加，修改标识
$("#add").on('click',function(){
	action_flag=0;
	index_add_form =layer.open({
		 type: 1,
		 title: '添加新闻', 
		 skin: 'layui-layer-rim', //加上边框
		 area: ['50%', '380px'], //宽高
		 anim:2,
		 content: $('#add_form')

	});
})
//点击添加确认
$("#add_form").on('submit',function(e){
	e.preventDefault();
	var id = $('#id').val();
	var title = $('#title').val();
	var author = $('#author').val();
	var description = $('#description').val();
	var action="";
	if(action_flag==0){
		action="add"
	}else{
		action="update"
	}
	if(action!=""){
		$.ajax({
			url:"Index",
			type:"post",
			data:{
				"action":action,
				"id":id,
				"title":title,
				"author":author,
				"description":description
			},		
			dataType:"text",
			success:function(data){
				data = JSON.parse(data);
				if(data.code==0){
					$('.my_table>tbody').empty().append("<tr><td colspan='6'>无数据</td></tr>")
				}else{
					$('#title').val("");
					$('#author').val("");
					$('#description').val("")				
					$('.my_table>tbody').empty();
					for(var i in data.result){
						$('.my_table>tbody').append("<tr><td>"+data.result[i].id+"</td><td>"+data.result[i].title+"</td><td>"+data.result[i].author+"</td><td>"+data.result[i].description+"</td><td>"+data.result[i].date+"</td><td><button class='btn btn-info btn-xs' id='modify'>修改</button>&nbsp;<button class='btn btn-danger btn-xs'  id='remove'>删除</button></td></tr>")
					}					
				}
			}
		})	
	}
	layer.close(index_add_form);

})
//删除新闻
$(document).on('click','#remove',function(){
	var cur_id= $(this).parent().siblings().first().text();
	layer.confirm('确定要删除吗？', {
		  btn: ['确定','取消'] //按钮
	}, function(){
		$.ajax({
				url:"Index",
				type:"post",
				data:{
					"action":"remove",
					"id":cur_id
				},		
				dataType:"text",
				success:function(data){
					data = JSON.parse(data);
					if(data.code==0){
						$('.my_table>tbody').empty().append("<tr><td colspan='6'>无数据</td></tr>")
					}else{													
						$('.my_table>tbody').empty();
						for(var i in data.result){
							$('.my_table>tbody').append("<tr><td>"+data.result[i].id+"</td><td>"+data.result[i].title+"</td><td>"+data.result[i].author+"</td><td>"+data.result[i].description+"</td><td>"+data.result[i].date+"</td><td><button class='btn btn-info btn-xs' id='modify'>修改</button>&nbsp;<button class='btn btn-danger btn-xs'  id='remove'>删除</button></td></tr>")
						}	
						layer.msg('删除成功！')								
					}
				}
			}) 
	}, function(){
		 layer.msg('谢谢你留下我！');
	});	
})
//点击要修改的新闻，回显到表单中
$(document).on('click','#modify',function(){
	action_flag=1;
	var cur_id= $(this).parent().siblings().first().text();
	$.ajax({
		url:"Index",
		type:"post",
		data:{
			"action":"update_select",
			"id":cur_id
		},		
		dataType:"text",
		success:function(data){
			data = JSON.parse(data);
			$('#id').val(data.result[0].id);
			$('#title').val(data.result[0].title);
			$('#author').val(data.result[0].author);
			$('#description').val(data.result[0].description);
			index_add_form =layer.open({
				 type: 1,
				 title: '添加新闻', 
				 skin: 'layui-layer-rim', //加上边框
				 area: ['50%', '380px'], //宽高
				 anim:2,
				 content: $('#add_form'),
				 cancel: function(){ 
					 $('#id').val("");
					 $('#title').val("");
					 $('#author').val("");
					 $('#description').val("");   
			     }

			});
		}
	})
	
})


</script>
</body>
</html>